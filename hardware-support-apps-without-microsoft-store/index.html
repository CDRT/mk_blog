
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Ideas for managing Lenovo devices in the corporate environment.">
      
      
      
        <link rel="canonical" href="https://blog.lenovocdrt.com/hardware-support-apps-without-microsoft-store/">
      
      
        <link rel="prev" href="../lenovo-updates-catalog-v3-for-sccm/">
      
      
        <link rel="next" href="../dynamically-install-hardware-support-apps-with-configmgr/">
      
      
      <link rel="icon" href="../img/fav/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>Hardware Support Apps without Microsoft Store - ThinkDeploy Blog</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.e53b48f4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-288025816"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-288025816",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-288025816",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="light-blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#scripted-install-of-hardware-support-apps-during-a-task-sequence" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="ThinkDeploy Blog" class="md-header__button md-logo" aria-label="ThinkDeploy Blog" data-md-component="logo">
      
  <img src="../img/CDRT-REV-Red_s.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ThinkDeploy Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Hardware Support Apps without Microsoft Store
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="light-blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="blue-grey"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="ThinkDeploy Blog" class="md-nav__button md-logo" aria-label="ThinkDeploy Blog" data-md-component="logo">
      
  <img src="../img/CDRT-REV-Red_s.png" alt="logo">

    </a>
    ThinkDeploy Blog
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../about/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    About
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../feed.xml" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RSS
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Archive
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Archive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../archive/2025/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2025
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../archive/2024/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2024
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../archive/2023/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2023
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../archive/2022/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2022
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../archive/2021/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2021
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../archive/2020/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2020
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../archive/2019/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2019
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../archive/2018/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2018
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../archive/2017/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2017
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
  <div class="md-content md-content--post" data-md-component="content">
    <div class="md-sidebar md-sidebar--post" data-md-component="sidebar" data-md-type="navigation">
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner md-post">
          <nav class="md-nav md-nav--primary">
            <div class="md-post__back">
              <div class="md-nav__title md-nav__container">
                <a href=".." class="md-nav__link">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
                  <span class="md-ellipsis">
                    Back to index
                  </span>
                </a>
              </div>
            </div>
            
              <div class="md-post__authors md-typeset">
                
                  <div class="md-profile md-post__profile">
                    <span class="md-author md-author--long">
                      <img src="../img/fav/avatar.png" alt="Thad Lawson">
                    </span>
                    <span class="md-profile__description">
                      <strong>
                        
                          Thad Lawson
                        
                      </strong>
                      <br>
                      Deployment Expert
                    </span>
                  </div>
                
              </div>
            
            <ul class="md-post__meta md-nav__list">
              <li class="md-nav__item md-nav__item--section">
                <div class="md-post__title">
                  <span class="md-ellipsis">
                    Metadata
                  </span>
                </div>
                <nav class="md-nav">
                  <ul class="md-nav__list">
                    <li class="md-nav__item">
                      <div class="md-nav__link">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5z"/></svg>
                        <time datetime="2020-06-19 00:00:00+00:00" class="md-ellipsis">June 19, 2020</time>
                      </div>
                    </li>
                    
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M15 13h1.5v2.82l2.44 1.41-.75 1.3L15 16.69zm4-5H5v11h4.67c-.43-.91-.67-1.93-.67-3a7 7 0 0 1 7-7c1.07 0 2.09.24 3 .67zM5 21a2 2 0 0 1-2-2V5c0-1.11.89-2 2-2h1V1h2v2h8V1h2v2h1a2 2 0 0 1 2 2v6.1c1.24 1.26 2 2.99 2 4.9a7 7 0 0 1-7 7c-1.91 0-3.64-.76-4.9-2zm11-9.85A4.85 4.85 0 0 0 11.15 16c0 2.68 2.17 4.85 4.85 4.85A4.85 4.85 0 0 0 20.85 16c0-2.68-2.17-4.85-4.85-4.85"/></svg>
                          <time datetime="2024-04-10 00:00:00+00:00" class="md-ellipsis">April 10, 2024</time>
                        </div>
                      </li>
                    
                    
                    
                      
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7z"/></svg>
                          <span class="md-ellipsis">
                            
                              11 min read
                            
                          </span>
                        </div>
                      </li>
                    
                  </ul>
                </nav>
              </li>
            </ul>
            
          </nav>
          
            

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#scripted-install-of-hardware-support-apps-during-a-task-sequence" class="md-nav__link">
    <span class="md-ellipsis">
      Scripted Install of Hardware Support Apps during a Task Sequence
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memsccm-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      MEM/SCCM Implementation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MEM/SCCM Implementation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#windows-pe-optional-components-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      Windows PE Optional Components Requirements
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#packaging" class="md-nav__link">
    <span class="md-ellipsis">
      Packaging
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-sequence" class="md-nav__link">
    <span class="md-ellipsis">
      Task Sequence
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mdt-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      MDT Implementation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MDT Implementation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#winpe-features-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      WinPE Features Requirements
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#application" class="md-nav__link">
    <span class="md-ellipsis">
      Application
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mdt-task-sequence" class="md-nav__link">
    <span class="md-ellipsis">
      MDT Task Sequence
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#noteworthy" class="md-nav__link">
    <span class="md-ellipsis">
      Noteworthy
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
          
        </div>
      </div>
    </div>
    <article class="md-content__inner md-typeset">
      
        
  




  <h1>Hardware Support Apps without Microsoft Store</h1>

<p>With versions of Windows 10 since 1809, Microsoft has introduced the concept of Modern Drivers.  These new drivers have a few requirements:</p>
<ul>
<li>Declarative:  The driver must be INF installable with no co-installers</li>
<li>Componentized:  The driver must support the architecture of having a base driver with optional extension drivers for customizations above the base functionality</li>
<li>Hardware Support Apps:  Any software required for working with the device must be in the form of a UWP app available from the Microsoft Store and will be associated to this driver in the INF.</li>
</ul>
<!-- more -->
<p>One intent of these items is to simplify in-place upgrades.  With this approach, if a Windows 10 device is upgraded to a new build by Windows Update and any new drivers are required, Windows Update can install the driver and it can trigger the software to be installed automatically from the Microsoft Store.</p>
<p>But what happens if you have blocked access to the Microsoft Store?  You will end up with a driver installed for a component without the software to control the device.  Keep in mind that not all device drivers will require a software component.  However, for those that do you may need them to get the full user experience from your device.</p>
<p>So how do you deploy these Hardware Support Apps (HSAs) without using the Microsoft Store?  This is where Lenovo's Hardware Support App Packs come in.</p>
<p>Starting in late June of 2020 you will begin to see these show up on the Lenovo Support site on the Drivers &amp; Software page for the specific model, under the Enterprise Management component.  These will be available for the new products just launched and going forward.  The HSA Packs are similar to our SCCM Driver Packs.  They contain just the source files to install the apps for specific models.  One difference between the two is that the HSA Packs will typically need to be updated much less frequently.  With this architecture, the driver may change several times and continue to use the same HSA.</p>
<p>The HSA Pack will be a self-extracting executable file like our SCCM Driver Packs.  When you extract one you will get a folder structure with each app's source files contained in their own folder.  By default a folder with a random name will be used to prevent any kind of symlink vulnerability.</p>
<p><img alt="HSA directory" src="https://cdrt.github.io/mk_blog/img/2020/hsa_directory.png" /></p>
<h3 id="scripted-install-of-hardware-support-apps-during-a-task-sequence">Scripted Install of Hardware Support Apps during a Task Sequence<a class="headerlink" href="#scripted-install-of-hardware-support-apps-during-a-task-sequence" title="Permanent link">#</a></h3>
<p>We have created a script to read JSON manifest files provided in the HSA packs.  The script can be leveraged in MEM/SCCM or MDT.  Below is the PowerShell script you can use for installation.</p>
<div class="language-Powershell highlight"><span class="filename">Install-HSA.ps1</span><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c">################################################################################</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="c">##                                                                            ##</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="c">##      Title: Install-HSA.ps1                                                ##</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="c">##  Publisher: Lenovo                                                         ##</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="c">##    Version: 1.03                                                           ##</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="c">##       Date: 2024-04-10                                                     ##</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="c">##                                                                            ##</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="c">##                              Legal Disclaimer                              ##</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="c">##                                                                            ##</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="c">##  The sample scripts are not supported under any Lenovo standard support    ##</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="c">##  program or service. The sample scripts are provided AS IS without         ##</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="c">##  warranty of any kind. Lenovo further disclaims all implied warranties     ##</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="c">##  including, without limitation, any implied warranties of                  ##</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="c">##  merchantability or of fitness for a particular purpose. The entire risk   ##</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="c">##  arising out of the use or performance of the sample scripts and           ##</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="c">##  documentation remains with you. In no event shall Lenovo, its authors,    ##</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="c">##  or anyone else involved in the creation, production, or delivery of the   ##</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="c">##  scripts be liable for any damages whatsoever (including, without          ##</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="c">##  limitation, damages for loss of business profits, business                ##</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="c">##  interruption, loss of business information, or other pecuniary loss)      ##</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="c">##  arising out of the use of or inability to use the sample scripts or       ##</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="c">##  documentation, even if Lenovo has been advised of the possibility of      ##</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="c">##  such damages.                                                             ##</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="c">##                                                                            ##</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a><span class="c">################################################################################</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a><span class="cm">&lt;#</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a><span class="sd">.SYNOPSIS</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a><span class="cm">    List the names of or install Hardware Support Applications (HSA) by </span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a><span class="cm">    reading manifest files located in the subdirectories.</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a><span class="sd">.DESCRIPTION</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a><span class="cm">    By reading manifest files found in the subdirectories of a Hardware Support </span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a><span class="cm">    Applications Pack, this script allows for the deployment of one, many, or </span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a><span class="cm">    all Hardware Support Applications for a given model.  All installations are </span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a><span class="cm">    against an offline installation of Windows 10.</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a><span class="sd">.PARAMETER</span><span class="cm"> LIST</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a><span class="cm">    Used to list the names of all Hardware Support Applications in the </span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a><span class="cm">    subdirectories.  Returns the list of the Hardware Support </span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a><span class="cm"> Applications names to the screen.</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a><span class="cm">    -LIST</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a><span class="sd">.PARAMETER</span><span class="cm"> EXPORT</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50" href="#__codelineno-0-50"></a>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51" href="#__codelineno-0-51"></a><span class="cm">    Used to list the names of all Hardware Support Applications in the </span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52" href="#__codelineno-0-52"></a><span class="cm">    subdirectories.  Returns the list of names to the Export_{Date}{Time}.txt </span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53" href="#__codelineno-0-53"></a><span class="cm">    file in the directory from which the script was executed.</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54" href="#__codelineno-0-54"></a>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55" href="#__codelineno-0-55"></a><span class="cm">    -LIST -EXPORT</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56" href="#__codelineno-0-56"></a>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57" href="#__codelineno-0-57"></a><span class="sd">.PARAMETER</span><span class="cm"> OFFLINE</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58" href="#__codelineno-0-58"></a>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59" href="#__codelineno-0-59"></a><span class="cm">    Used to install the Hardware Support Applications.</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60" href="#__codelineno-0-60"></a>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61" href="#__codelineno-0-61"></a><span class="cm">    -OFFLINE {-ALL, FILE &#39;{FileName}.txt&#39;, or -NAME &#39;{HSA Name}&#39;}</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62" href="#__codelineno-0-62"></a>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63" href="#__codelineno-0-63"></a><span class="sd">.PARAMETER</span><span class="cm"> ALL</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64" href="#__codelineno-0-64"></a>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65" href="#__codelineno-0-65"></a><span class="cm">    Used to install all Hardware Support Applications in the subdirectories </span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66" href="#__codelineno-0-66"></a><span class="cm">    below the script.</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67" href="#__codelineno-0-67"></a>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68" href="#__codelineno-0-68"></a><span class="cm">    -OFFLINE -ALL</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69" href="#__codelineno-0-69"></a>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70" href="#__codelineno-0-70"></a><span class="sd">.PARAMETER</span><span class="cm"> FILE</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71" href="#__codelineno-0-71"></a>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72" href="#__codelineno-0-72"></a><span class="cm">    Used to install a list of Hardware Support Applications.  The text file </span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73" href="#__codelineno-0-73"></a><span class="cm">    should be formatted with one Hardware Support Application name per line.  </span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74" href="#__codelineno-0-74"></a><span class="cm">    The file should reside in the same folder as the Install-HSA.ps1 script.  </span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75" href="#__codelineno-0-75"></a><span class="cm">    The names can be found using the -LIST parameter.  </span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76" href="#__codelineno-0-76"></a>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77" href="#__codelineno-0-77"></a><span class="cm">    -OFFLINE -FILE &#39;{FileName}.txt&#39;</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78" href="#__codelineno-0-78"></a>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79" href="#__codelineno-0-79"></a><span class="sd">.PARAMETER</span><span class="cm"> NAME</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80" href="#__codelineno-0-80"></a>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81" href="#__codelineno-0-81"></a><span class="cm">    Used to install one Hardware Support Application.  The name can be found </span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82" href="#__codelineno-0-82"></a><span class="cm">    using the -LIST parameter.</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83" href="#__codelineno-0-83"></a>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84" href="#__codelineno-0-84"></a><span class="cm">    -OFFLINE -NAME &#39;{HSA Name}&#39;</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85" href="#__codelineno-0-85"></a>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86" href="#__codelineno-0-86"></a><span class="sd">.PARAMETER</span><span class="cm"> NOSMSTS</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87" href="#__codelineno-0-87"></a>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88" href="#__codelineno-0-88"></a><span class="cm">    Used when running in WinPE, but not in a Microsoft.SMS.TSEnvironment, </span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89" href="#__codelineno-0-89"></a><span class="cm">    provided by Microsoft Endpoint Manager (MEM), System Center </span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90" href="#__codelineno-0-90"></a><span class="cm">    Configuration Manager (SCCM), or Microsoft Deployment Toolkit (MDT).</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91" href="#__codelineno-0-91"></a>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92" href="#__codelineno-0-92"></a><span class="cm">    Call this parameter with the drive letter where the Windows partition has </span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93" href="#__codelineno-0-93"></a><span class="cm">    the Windows folder already installed.</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94" href="#__codelineno-0-94"></a>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95" href="#__codelineno-0-95"></a><span class="cm">    -NOSMSTS &#39;{Drive Letter}:&#39;</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96" href="#__codelineno-0-96"></a>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97" href="#__codelineno-0-97"></a><span class="sd">.PARAMETER</span><span class="cm"> DEBUGINFORMATION</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98" href="#__codelineno-0-98"></a>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99" href="#__codelineno-0-99"></a><span class="cm">    Use to turn on Transcript logging and full logging of DISM Commands.  The </span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100" href="#__codelineno-0-100"></a><span class="cm">    transcript file can be found at C:\Windows\Logs.  There will be a separate  </span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101" href="#__codelineno-0-101"></a><span class="cm">    log file from each DISM command generated at C:\Windows\Logs\DISM.</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102" href="#__codelineno-0-102"></a>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103" href="#__codelineno-0-103"></a><span class="cm">    -DEBUGINFORMATION</span>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104" href="#__codelineno-0-104"></a>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105" href="#__codelineno-0-105"></a><span class="sd">.EXAMPLE</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106" href="#__codelineno-0-106"></a>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107" href="#__codelineno-0-107"></a><span class="cm">    .\Install-HSA.ps1 -LIST</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108" href="#__codelineno-0-108"></a>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109" href="#__codelineno-0-109"></a><span class="sd">.EXAMPLE</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110" href="#__codelineno-0-110"></a>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111" href="#__codelineno-0-111"></a><span class="cm">    .\Install-HSA.ps1 -LIST -EXPORT</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112" href="#__codelineno-0-112"></a>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113" href="#__codelineno-0-113"></a><span class="sd">.EXAMPLE</span>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114" href="#__codelineno-0-114"></a>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115" href="#__codelineno-0-115"></a><span class="cm">    .\Install-HSA.ps1 -OFFLINE -NAME &#39;Lenovo Pen Settings&#39;</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116" href="#__codelineno-0-116"></a>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117" href="#__codelineno-0-117"></a><span class="sd">.EXAMPLE</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118" href="#__codelineno-0-118"></a>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119" href="#__codelineno-0-119"></a><span class="cm">    .\Install-HSA.ps1 -OFFLINE -FILE &#39;List.txt&#39;</span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120" href="#__codelineno-0-120"></a>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121" href="#__codelineno-0-121"></a><span class="sd">.EXAMPLE</span>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122" href="#__codelineno-0-122"></a>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123" href="#__codelineno-0-123"></a><span class="cm">    .\Install-HSA.ps1 -OFFLINE -NOSMSTS &#39;D:&#39; -ALL</span>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124" href="#__codelineno-0-124"></a>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125" href="#__codelineno-0-125"></a><span class="sd">.EXAMPLE</span>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126" href="#__codelineno-0-126"></a>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127" href="#__codelineno-0-127"></a><span class="cm">    .\Install-HSA.ps1 -OFFLINE -NOSMSTS &#39;D:&#39; -ALL -DEBUGINFORMATION</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128" href="#__codelineno-0-128"></a>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129" href="#__codelineno-0-129"></a><span class="sd">.NOTES</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130" href="#__codelineno-0-130"></a>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131" href="#__codelineno-0-131"></a><span class="cm">    Return Code 1 : Both the -LIST and -OFFLINE commands were used.  Only one </span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132" href="#__codelineno-0-132"></a><span class="cm">                    of these two parameters can be used at a time.</span>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133" href="#__codelineno-0-133"></a><span class="cm">    Return Code 2 : More than one -ALL, -FILE, or -NAME were used.  Only one </span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134" href="#__codelineno-0-134"></a><span class="cm">                    of these three parameters can be used at a time.</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135" href="#__codelineno-0-135"></a><span class="cm">    Return Code 3 : No *_HSA_Manifest.json files were found in the </span>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136" href="#__codelineno-0-136"></a><span class="cm">                    subdirectories.</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137" href="#__codelineno-0-137"></a><span class="cm">    Return Code 4 : When using the -FILE parameter, the file name was not </span>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138" href="#__codelineno-0-138"></a><span class="cm">                    found in the directory where the script resides.</span>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139" href="#__codelineno-0-139"></a>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140" href="#__codelineno-0-140"></a><span class="cm">#&gt;</span>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141" href="#__codelineno-0-141"></a>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142" href="#__codelineno-0-142"></a><span class="cm">&lt;#</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143" href="#__codelineno-0-143"></a><span class="cm">Version history</span>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144" href="#__codelineno-0-144"></a>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145" href="#__codelineno-0-145"></a><span class="cm">- 1.03: Remove incompatible characters from the log file name.</span>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146" href="#__codelineno-0-146"></a>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147" href="#__codelineno-0-147"></a><span class="cm">- 1.02: Initial Release</span>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148" href="#__codelineno-0-148"></a>
</span><span id="__span-0-149"><a id="__codelineno-0-149" name="__codelineno-0-149" href="#__codelineno-0-149"></a><span class="cm">#&gt;</span>
</span><span id="__span-0-150"><a id="__codelineno-0-150" name="__codelineno-0-150" href="#__codelineno-0-150"></a>
</span><span id="__span-0-151"><a id="__codelineno-0-151" name="__codelineno-0-151" href="#__codelineno-0-151"></a><span class="c">#######################</span>
</span><span id="__span-0-152"><a id="__codelineno-0-152" name="__codelineno-0-152" href="#__codelineno-0-152"></a><span class="c">#  SCRIPT PARAMETERS  #</span>
</span><span id="__span-0-153"><a id="__codelineno-0-153" name="__codelineno-0-153" href="#__codelineno-0-153"></a><span class="c">#######################</span>
</span><span id="__span-0-154"><a id="__codelineno-0-154" name="__codelineno-0-154" href="#__codelineno-0-154"></a><span class="p">[</span><span class="k">CmdletBinding</span><span class="p">(</span><span class="n">DefaultParameterSetName</span> <span class="p">=</span> <span class="s1">&#39;GetList&#39;</span><span class="p">)]</span>
</span><span id="__span-0-155"><a id="__codelineno-0-155" name="__codelineno-0-155" href="#__codelineno-0-155"></a><span class="k">Param</span><span class="p">(</span>
</span><span id="__span-0-156"><a id="__codelineno-0-156" name="__codelineno-0-156" href="#__codelineno-0-156"></a>    <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">ParameterSetName</span> <span class="p">=</span> <span class="s1">&#39;GetList&#39;</span><span class="p">)]</span>
</span><span id="__span-0-157"><a id="__codelineno-0-157" name="__codelineno-0-157" href="#__codelineno-0-157"></a>    <span class="no">[switch]</span><span class="nv">$List</span><span class="p">,</span>
</span><span id="__span-0-158"><a id="__codelineno-0-158" name="__codelineno-0-158" href="#__codelineno-0-158"></a>    <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">ParameterSetName</span> <span class="p">=</span> <span class="s1">&#39;GetList&#39;</span><span class="p">)]</span>
</span><span id="__span-0-159"><a id="__codelineno-0-159" name="__codelineno-0-159" href="#__codelineno-0-159"></a>    <span class="no">[switch]</span><span class="nv">$Export</span><span class="p">,</span>
</span><span id="__span-0-160"><a id="__codelineno-0-160" name="__codelineno-0-160" href="#__codelineno-0-160"></a>    <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">ParameterSetName</span> <span class="p">=</span> <span class="s1">&#39;InstallOffline&#39;</span><span class="p">)]</span>
</span><span id="__span-0-161"><a id="__codelineno-0-161" name="__codelineno-0-161" href="#__codelineno-0-161"></a>    <span class="no">[switch]</span><span class="nv">$Offline</span><span class="p">,</span>
</span><span id="__span-0-162"><a id="__codelineno-0-162" name="__codelineno-0-162" href="#__codelineno-0-162"></a>    <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">ParameterSetName</span> <span class="p">=</span> <span class="s1">&#39;InstallOffline&#39;</span><span class="p">)]</span>
</span><span id="__span-0-163"><a id="__codelineno-0-163" name="__codelineno-0-163" href="#__codelineno-0-163"></a>    <span class="p">[</span><span class="n">ValidateNotNullOrEmpty</span><span class="p">()]</span>
</span><span id="__span-0-164"><a id="__codelineno-0-164" name="__codelineno-0-164" href="#__codelineno-0-164"></a>    <span class="no">[string]</span><span class="nv">$Name</span><span class="p">,</span>
</span><span id="__span-0-165"><a id="__codelineno-0-165" name="__codelineno-0-165" href="#__codelineno-0-165"></a>    <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">ParameterSetName</span> <span class="p">=</span> <span class="s1">&#39;InstallOffline&#39;</span><span class="p">)]</span>
</span><span id="__span-0-166"><a id="__codelineno-0-166" name="__codelineno-0-166" href="#__codelineno-0-166"></a>    <span class="p">[</span><span class="n">ValidateNotNullOrEmpty</span><span class="p">()]</span>
</span><span id="__span-0-167"><a id="__codelineno-0-167" name="__codelineno-0-167" href="#__codelineno-0-167"></a>    <span class="no">[string]</span><span class="nv">$File</span><span class="p">,</span>
</span><span id="__span-0-168"><a id="__codelineno-0-168" name="__codelineno-0-168" href="#__codelineno-0-168"></a>    <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">ParameterSetName</span> <span class="p">=</span> <span class="s1">&#39;InstallOffline&#39;</span><span class="p">)]</span>
</span><span id="__span-0-169"><a id="__codelineno-0-169" name="__codelineno-0-169" href="#__codelineno-0-169"></a>    <span class="no">[switch]</span><span class="nv">$All</span><span class="p">,</span>
</span><span id="__span-0-170"><a id="__codelineno-0-170" name="__codelineno-0-170" href="#__codelineno-0-170"></a>    <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">ParameterSetName</span> <span class="p">=</span> <span class="s1">&#39;InstallOffline&#39;</span><span class="p">)]</span>
</span><span id="__span-0-171"><a id="__codelineno-0-171" name="__codelineno-0-171" href="#__codelineno-0-171"></a>    <span class="p">[</span><span class="n">ValidateNotNullOrEmpty</span><span class="p">()]</span>
</span><span id="__span-0-172"><a id="__codelineno-0-172" name="__codelineno-0-172" href="#__codelineno-0-172"></a>    <span class="no">[string]</span><span class="nv">$NoSMSTS</span><span class="p">,</span>
</span><span id="__span-0-173"><a id="__codelineno-0-173" name="__codelineno-0-173" href="#__codelineno-0-173"></a>    <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">ParameterSetName</span> <span class="p">=</span> <span class="s1">&#39;GetList&#39;</span><span class="p">)]</span>
</span><span id="__span-0-174"><a id="__codelineno-0-174" name="__codelineno-0-174" href="#__codelineno-0-174"></a>    <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">ParameterSetName</span> <span class="p">=</span> <span class="s1">&#39;InstallOffline&#39;</span><span class="p">)]</span>
</span><span id="__span-0-175"><a id="__codelineno-0-175" name="__codelineno-0-175" href="#__codelineno-0-175"></a>    <span class="no">[switch]</span><span class="nv">$DebugInformation</span>
</span><span id="__span-0-176"><a id="__codelineno-0-176" name="__codelineno-0-176" href="#__codelineno-0-176"></a><span class="p">)</span>
</span><span id="__span-0-177"><a id="__codelineno-0-177" name="__codelineno-0-177" href="#__codelineno-0-177"></a><span class="c">###############</span>
</span><span id="__span-0-178"><a id="__codelineno-0-178" name="__codelineno-0-178" href="#__codelineno-0-178"></a><span class="c">#  FUNCTIONS  #</span>
</span><span id="__span-0-179"><a id="__codelineno-0-179" name="__codelineno-0-179" href="#__codelineno-0-179"></a><span class="c">###############</span>
</span><span id="__span-0-180"><a id="__codelineno-0-180" name="__codelineno-0-180" href="#__codelineno-0-180"></a><span class="c">#Install-HSA</span>
</span><span id="__span-0-181"><a id="__codelineno-0-181" name="__codelineno-0-181" href="#__codelineno-0-181"></a><span class="k">Function</span> <span class="nb">Install-HSA</span>
</span><span id="__span-0-182"><a id="__codelineno-0-182" name="__codelineno-0-182" href="#__codelineno-0-182"></a><span class="p">{</span>
</span><span id="__span-0-183"><a id="__codelineno-0-183" name="__codelineno-0-183" href="#__codelineno-0-183"></a>    <span class="p">[</span><span class="k">CmdletBinding</span><span class="p">()]</span>
</span><span id="__span-0-184"><a id="__codelineno-0-184" name="__codelineno-0-184" href="#__codelineno-0-184"></a>    <span class="k">param</span> <span class="p">(</span>
</span><span id="__span-0-185"><a id="__codelineno-0-185" name="__codelineno-0-185" href="#__codelineno-0-185"></a>        <span class="no">[PSCustomObject]</span><span class="nv">$HSAPackage</span><span class="p">,</span>
</span><span id="__span-0-186"><a id="__codelineno-0-186" name="__codelineno-0-186" href="#__codelineno-0-186"></a>        <span class="no">[String]</span><span class="nv">$HSAName</span>
</span><span id="__span-0-187"><a id="__codelineno-0-187" name="__codelineno-0-187" href="#__codelineno-0-187"></a>    <span class="p">)</span>
</span><span id="__span-0-188"><a id="__codelineno-0-188" name="__codelineno-0-188" href="#__codelineno-0-188"></a>    <span class="nv">$OutDep</span> <span class="p">=</span> <span class="nv">$Null</span>
</span><span id="__span-0-189"><a id="__codelineno-0-189" name="__codelineno-0-189" href="#__codelineno-0-189"></a>    <span class="k">If</span><span class="p">(((</span><span class="nv">$HSAName</span> <span class="o">-contains</span> <span class="nv">$HSAPackage</span><span class="p">.</span><span class="n">hsa</span><span class="p">)</span> <span class="o">-and</span> <span class="p">(</span><span class="nv">$Null</span> <span class="o">-ne</span> <span class="nv">$HSAName</span><span class="p">))</span><span class="o">-or</span> <span class="nv">$All</span><span class="p">)</span>
</span><span id="__span-0-190"><a id="__codelineno-0-190" name="__codelineno-0-190" href="#__codelineno-0-190"></a>    <span class="p">{</span>
</span><span id="__span-0-191"><a id="__codelineno-0-191" name="__codelineno-0-191" href="#__codelineno-0-191"></a>        <span class="k">ForEach</span><span class="p">(</span><span class="nv">$Dep</span> <span class="k">in</span> <span class="nv">$HSAPackage</span><span class="p">.</span><span class="n">Dependencies</span><span class="p">)</span>
</span><span id="__span-0-192"><a id="__codelineno-0-192" name="__codelineno-0-192" href="#__codelineno-0-192"></a>        <span class="p">{</span>
</span><span id="__span-0-193"><a id="__codelineno-0-193" name="__codelineno-0-193" href="#__codelineno-0-193"></a>            <span class="nv">$OutDep</span> <span class="p">+=</span> <span class="s2">&quot; /DependencyPackagePath:</span><span class="se">`&quot;</span><span class="p">$(</span><span class="nv">$HSAPackage</span><span class="p">.</span><span class="n">JSONPath</span><span class="p">)</span><span class="s2">\</span><span class="p">$(</span><span class="nv">$Dep</span><span class="p">)</span><span class="se">`&quot;</span><span class="s2">&quot;</span>
</span><span id="__span-0-194"><a id="__codelineno-0-194" name="__codelineno-0-194" href="#__codelineno-0-194"></a>        <span class="p">}</span>
</span><span id="__span-0-195"><a id="__codelineno-0-195" name="__codelineno-0-195" href="#__codelineno-0-195"></a>        <span class="nv">$DISMLog</span> <span class="p">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="__span-0-196"><a id="__codelineno-0-196" name="__codelineno-0-196" href="#__codelineno-0-196"></a>        <span class="k">If</span><span class="p">(</span><span class="nv">$DebugInformation</span><span class="p">)</span>
</span><span id="__span-0-197"><a id="__codelineno-0-197" name="__codelineno-0-197" href="#__codelineno-0-197"></a>        <span class="p">{</span>
</span><span id="__span-0-198"><a id="__codelineno-0-198" name="__codelineno-0-198" href="#__codelineno-0-198"></a>            <span class="k">If</span><span class="p">(!(</span><span class="nb">Test-Path</span> <span class="n">-Path</span> <span class="s2">&quot;</span><span class="p">$(</span><span class="nv">$LogPath</span><span class="p">)</span><span class="s2">\DISM&quot;</span><span class="p">))</span>
</span><span id="__span-0-199"><a id="__codelineno-0-199" name="__codelineno-0-199" href="#__codelineno-0-199"></a>            <span class="p">{</span>
</span><span id="__span-0-200"><a id="__codelineno-0-200" name="__codelineno-0-200" href="#__codelineno-0-200"></a>                <span class="nb">New-Item</span> <span class="n">-Path</span> <span class="s2">&quot;</span><span class="p">$(</span><span class="nv">$LogPath</span><span class="p">)</span><span class="s2">\DISM&quot;</span> <span class="n">-ItemType</span> <span class="n">Directory</span>
</span><span id="__span-0-201"><a id="__codelineno-0-201" name="__codelineno-0-201" href="#__codelineno-0-201"></a>            <span class="p">}</span>
</span><span id="__span-0-202"><a id="__codelineno-0-202" name="__codelineno-0-202" href="#__codelineno-0-202"></a>            <span class="nv">$HsaLogName</span> <span class="p">=</span> <span class="p">$(</span><span class="nv">$HSAPackage</span><span class="p">.</span><span class="n">hsa</span><span class="p">)</span> <span class="o">-replace</span> <span class="s1">&#39;\&lt;|\&gt;|:|&quot;|/|\\|\||\?|\*&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span>
</span><span id="__span-0-203"><a id="__codelineno-0-203" name="__codelineno-0-203" href="#__codelineno-0-203"></a>            <span class="nv">$DISMLog</span> <span class="p">=</span> <span class="s2">&quot; /LogLevel:4 /LogPath:</span><span class="se">`&quot;</span><span class="s2">$LogPath\DISM\$HsaLogName.log</span><span class="se">`&quot;</span><span class="s2">&quot;</span>
</span><span id="__span-0-204"><a id="__codelineno-0-204" name="__codelineno-0-204" href="#__codelineno-0-204"></a>        <span class="p">}</span>
</span><span id="__span-0-205"><a id="__codelineno-0-205" name="__codelineno-0-205" href="#__codelineno-0-205"></a>        <span class="nv">$DISMArgs</span> <span class="p">=</span> <span class="s2">&quot;/Add-ProvisionedAppxPackage /PackagePath:</span><span class="se">`&quot;</span><span class="p">$(</span><span class="nv">$HSAPackage</span><span class="p">.</span><span class="n">JSONPath</span><span class="p">)</span><span class="s2">\</span><span class="p">$(</span><span class="nv">$HSAPackage</span><span class="p">.</span><span class="n">appx</span><span class="p">)</span><span class="se">`&quot;</span><span class="s2"> /LicensePath:</span><span class="se">`&quot;</span><span class="p">$(</span><span class="nv">$HSAPackage</span><span class="p">.</span><span class="n">JSONPath</span><span class="p">)</span><span class="s2">\</span><span class="p">$(</span><span class="nv">$HSAPackage</span><span class="p">.</span><span class="n">license</span><span class="p">)</span><span class="se">`&quot;</span><span class="p">$(</span><span class="nv">$OutDep</span><span class="p">)</span><span class="s2"> /Region:</span><span class="se">`&quot;</span><span class="s2">All</span><span class="se">`&quot;</span><span class="s2">$DISMLog&quot;</span>
</span><span id="__span-0-206"><a id="__codelineno-0-206" name="__codelineno-0-206" href="#__codelineno-0-206"></a>        <span class="nb">Write-Host</span> <span class="s2">&quot;Offline DISM - </span><span class="p">$(</span><span class="nv">$HSAPackage</span><span class="p">.</span><span class="n">hsa</span><span class="p">)</span><span class="s2">&quot;</span>
</span><span id="__span-0-207"><a id="__codelineno-0-207" name="__codelineno-0-207" href="#__codelineno-0-207"></a>        <span class="k">If</span><span class="p">(</span><span class="nv">$NoSMSTSPresent</span><span class="p">)</span>
</span><span id="__span-0-208"><a id="__codelineno-0-208" name="__codelineno-0-208" href="#__codelineno-0-208"></a>        <span class="p">{</span>
</span><span id="__span-0-209"><a id="__codelineno-0-209" name="__codelineno-0-209" href="#__codelineno-0-209"></a>            <span class="nb">Write-Host</span> <span class="s2">&quot;Using string data from NoSMSTS parameter to define the root drive letter for the DISM /Image parameter.&quot;</span>
</span><span id="__span-0-210"><a id="__codelineno-0-210" name="__codelineno-0-210" href="#__codelineno-0-210"></a>        <span class="p">}</span>
</span><span id="__span-0-211"><a id="__codelineno-0-211" name="__codelineno-0-211" href="#__codelineno-0-211"></a>        <span class="nv">$DISMArgs</span> <span class="p">=</span> <span class="s2">&quot;/Image:</span><span class="p">$(</span><span class="nv">$Drive</span><span class="p">)</span><span class="s2">\ </span><span class="p">$(</span><span class="nv">$DISMArgs</span><span class="p">)</span><span class="s2">&quot;</span>
</span><span id="__span-0-212"><a id="__codelineno-0-212" name="__codelineno-0-212" href="#__codelineno-0-212"></a>        <span class="nb">Write-Host</span> <span class="s2">&quot;$env:windir\system32\Dism.exe $DISMArgs&quot;</span>
</span><span id="__span-0-213"><a id="__codelineno-0-213" name="__codelineno-0-213" href="#__codelineno-0-213"></a>        <span class="nb">Start-Process</span> <span class="n">-FilePath</span> <span class="s2">&quot;$env:windir\system32\Dism.exe&quot;</span> <span class="n">-ArgumentList</span> <span class="nv">$DISMArgs</span> <span class="n">-Wait</span> <span class="n">-WindowStyle</span> <span class="n">Hidden</span>
</span><span id="__span-0-214"><a id="__codelineno-0-214" name="__codelineno-0-214" href="#__codelineno-0-214"></a>    <span class="p">}</span>
</span><span id="__span-0-215"><a id="__codelineno-0-215" name="__codelineno-0-215" href="#__codelineno-0-215"></a><span class="p">}</span>
</span><span id="__span-0-216"><a id="__codelineno-0-216" name="__codelineno-0-216" href="#__codelineno-0-216"></a><span class="c">##################</span>
</span><span id="__span-0-217"><a id="__codelineno-0-217" name="__codelineno-0-217" href="#__codelineno-0-217"></a><span class="c">#  SCRIPT SETUP  #</span>
</span><span id="__span-0-218"><a id="__codelineno-0-218" name="__codelineno-0-218" href="#__codelineno-0-218"></a><span class="c">##################</span>
</span><span id="__span-0-219"><a id="__codelineno-0-219" name="__codelineno-0-219" href="#__codelineno-0-219"></a><span class="nv">$FilePresent</span> <span class="p">=</span> <span class="nv">$false</span>
</span><span id="__span-0-220"><a id="__codelineno-0-220" name="__codelineno-0-220" href="#__codelineno-0-220"></a><span class="nv">$NamePresent</span> <span class="p">=</span> <span class="nv">$false</span>
</span><span id="__span-0-221"><a id="__codelineno-0-221" name="__codelineno-0-221" href="#__codelineno-0-221"></a><span class="nv">$NoSMSTSPresent</span> <span class="p">=</span> <span class="nv">$false</span>
</span><span id="__span-0-222"><a id="__codelineno-0-222" name="__codelineno-0-222" href="#__codelineno-0-222"></a><span class="k">If</span><span class="p">((</span><span class="nv">$PSBoundParameters</span><span class="p">.</span><span class="n">ContainsKey</span><span class="p">(</span><span class="s1">&#39;List&#39;</span><span class="p">)</span> <span class="o">-and</span> <span class="nv">$PSBoundParameters</span><span class="p">.</span><span class="n">ContainsKey</span><span class="p">(</span><span class="s1">&#39;Offline&#39;</span><span class="p">)))</span>
</span><span id="__span-0-223"><a id="__codelineno-0-223" name="__codelineno-0-223" href="#__codelineno-0-223"></a><span class="p">{</span>
</span><span id="__span-0-224"><a id="__codelineno-0-224" name="__codelineno-0-224" href="#__codelineno-0-224"></a>    <span class="nb">Write-Host</span> <span class="s2">&quot;Use just one from the following list of parameters: -List or -Offline.  Review the script usage information for using these parameters.&quot;</span>
</span><span id="__span-0-225"><a id="__codelineno-0-225" name="__codelineno-0-225" href="#__codelineno-0-225"></a>    <span class="k">Return</span> <span class="n">1</span>
</span><span id="__span-0-226"><a id="__codelineno-0-226" name="__codelineno-0-226" href="#__codelineno-0-226"></a><span class="p">}</span>
</span><span id="__span-0-227"><a id="__codelineno-0-227" name="__codelineno-0-227" href="#__codelineno-0-227"></a><span class="k">If</span><span class="p">(</span><span class="nv">$Offline</span><span class="p">)</span>
</span><span id="__span-0-228"><a id="__codelineno-0-228" name="__codelineno-0-228" href="#__codelineno-0-228"></a><span class="p">{</span>
</span><span id="__span-0-229"><a id="__codelineno-0-229" name="__codelineno-0-229" href="#__codelineno-0-229"></a>    <span class="k">If</span><span class="p">((</span><span class="nv">$PSBoundParameters</span><span class="p">.</span><span class="n">ContainsKey</span><span class="p">(</span><span class="s1">&#39;All&#39;</span><span class="p">)</span> <span class="o">-and</span> <span class="nv">$PSBoundParameters</span><span class="p">.</span><span class="n">ContainsKey</span><span class="p">(</span><span class="s1">&#39;File&#39;</span><span class="p">)</span> <span class="o">-and</span> <span class="nv">$PSBoundParameters</span><span class="p">.</span><span class="n">ContainsKey</span><span class="p">(</span><span class="s1">&#39;Name&#39;</span><span class="p">))</span> <span class="o">-or</span> <span class="p">(</span><span class="nv">$PSBoundParameters</span><span class="p">.</span><span class="n">ContainsKey</span><span class="p">(</span><span class="s1">&#39;All&#39;</span><span class="p">)</span> <span class="o">-and</span> <span class="nv">$PSBoundParameters</span><span class="p">.</span><span class="n">ContainsKey</span><span class="p">(</span><span class="s1">&#39;File&#39;</span><span class="p">))</span> <span class="o">-or</span> <span class="p">(</span><span class="nv">$PSBoundParameters</span><span class="p">.</span><span class="n">ContainsKey</span><span class="p">(</span><span class="s1">&#39;All&#39;</span><span class="p">)</span> <span class="o">-and</span> <span class="nv">$PSBoundParameters</span><span class="p">.</span><span class="n">ContainsKey</span><span class="p">(</span><span class="s1">&#39;Name&#39;</span><span class="p">))</span> <span class="o">-or</span> <span class="p">(</span><span class="nv">$PSBoundParameters</span><span class="p">.</span><span class="n">ContainsKey</span><span class="p">(</span><span class="s1">&#39;File&#39;</span><span class="p">)</span> <span class="o">-and</span> <span class="nv">$PSBoundParameters</span><span class="p">.</span><span class="n">ContainsKey</span><span class="p">(</span><span class="s1">&#39;Name&#39;</span><span class="p">))</span> <span class="o">-or</span> <span class="p">((!(</span><span class="nv">$PSBoundParameters</span><span class="p">.</span><span class="n">ContainsKey</span><span class="p">(</span><span class="s1">&#39;All&#39;</span><span class="p">))</span> <span class="o">-and</span> <span class="p">(!(</span><span class="nv">$PSBoundParameters</span><span class="p">.</span><span class="n">ContainsKey</span><span class="p">(</span><span class="s1">&#39;File&#39;</span><span class="p">)))</span> <span class="o">-and</span> <span class="p">(!(</span><span class="nv">$PSBoundParameters</span><span class="p">.</span><span class="n">ContainsKey</span><span class="p">(</span><span class="s1">&#39;Name&#39;</span><span class="p">))))))</span>
</span><span id="__span-0-230"><a id="__codelineno-0-230" name="__codelineno-0-230" href="#__codelineno-0-230"></a>    <span class="p">{</span>
</span><span id="__span-0-231"><a id="__codelineno-0-231" name="__codelineno-0-231" href="#__codelineno-0-231"></a>        <span class="nb">Write-Host</span> <span class="s2">&quot;Use just one from the following list of parameters: -All, -Name, or -File.  Review the script usage information for using these parameters.&quot;</span>
</span><span id="__span-0-232"><a id="__codelineno-0-232" name="__codelineno-0-232" href="#__codelineno-0-232"></a>        <span class="k">Return</span> <span class="n">2</span>
</span><span id="__span-0-233"><a id="__codelineno-0-233" name="__codelineno-0-233" href="#__codelineno-0-233"></a>    <span class="p">}</span>
</span><span id="__span-0-234"><a id="__codelineno-0-234" name="__codelineno-0-234" href="#__codelineno-0-234"></a>    <span class="k">ElseIf</span><span class="p">(</span><span class="nv">$PSBoundParameters</span><span class="p">.</span><span class="n">ContainsKey</span><span class="p">(</span><span class="s1">&#39;File&#39;</span><span class="p">))</span>
</span><span id="__span-0-235"><a id="__codelineno-0-235" name="__codelineno-0-235" href="#__codelineno-0-235"></a>    <span class="p">{</span>
</span><span id="__span-0-236"><a id="__codelineno-0-236" name="__codelineno-0-236" href="#__codelineno-0-236"></a>        <span class="nv">$FilePresent</span> <span class="p">=</span> <span class="nv">$true</span>
</span><span id="__span-0-237"><a id="__codelineno-0-237" name="__codelineno-0-237" href="#__codelineno-0-237"></a>    <span class="p">}</span>
</span><span id="__span-0-238"><a id="__codelineno-0-238" name="__codelineno-0-238" href="#__codelineno-0-238"></a>    <span class="k">ElseIf</span><span class="p">(</span><span class="nv">$PSBoundParameters</span><span class="p">.</span><span class="n">ContainsKey</span><span class="p">(</span><span class="s1">&#39;Name&#39;</span><span class="p">))</span>
</span><span id="__span-0-239"><a id="__codelineno-0-239" name="__codelineno-0-239" href="#__codelineno-0-239"></a>    <span class="p">{</span>
</span><span id="__span-0-240"><a id="__codelineno-0-240" name="__codelineno-0-240" href="#__codelineno-0-240"></a>        <span class="nv">$NamePresent</span> <span class="p">=</span> <span class="nv">$true</span>
</span><span id="__span-0-241"><a id="__codelineno-0-241" name="__codelineno-0-241" href="#__codelineno-0-241"></a>    <span class="p">}</span>
</span><span id="__span-0-242"><a id="__codelineno-0-242" name="__codelineno-0-242" href="#__codelineno-0-242"></a><span class="p">}</span>
</span><span id="__span-0-243"><a id="__codelineno-0-243" name="__codelineno-0-243" href="#__codelineno-0-243"></a><span class="k">If</span><span class="p">(</span><span class="nv">$PSBoundParameters</span><span class="p">.</span><span class="n">ContainsKey</span><span class="p">(</span><span class="s1">&#39;NoSMSTS&#39;</span><span class="p">))</span>
</span><span id="__span-0-244"><a id="__codelineno-0-244" name="__codelineno-0-244" href="#__codelineno-0-244"></a><span class="p">{</span>
</span><span id="__span-0-245"><a id="__codelineno-0-245" name="__codelineno-0-245" href="#__codelineno-0-245"></a>    <span class="nv">$NoSMSTSPresent</span> <span class="p">=</span> <span class="nv">$true</span>
</span><span id="__span-0-246"><a id="__codelineno-0-246" name="__codelineno-0-246" href="#__codelineno-0-246"></a><span class="p">}</span>
</span><span id="__span-0-247"><a id="__codelineno-0-247" name="__codelineno-0-247" href="#__codelineno-0-247"></a><span class="c">#Setup Vars</span>
</span><span id="__span-0-248"><a id="__codelineno-0-248" name="__codelineno-0-248" href="#__codelineno-0-248"></a><span class="nv">$ScriptDir</span> <span class="p">=</span> <span class="nb">Split-Path</span> <span class="nv">$Script:MyInvocation</span><span class="p">.</span><span class="n">MyCommand</span><span class="p">.</span><span class="n">Path</span>
</span><span id="__span-0-249"><a id="__codelineno-0-249" name="__codelineno-0-249" href="#__codelineno-0-249"></a><span class="k">If</span><span class="p">((</span><span class="nv">$Offline</span><span class="p">)</span> <span class="o">-and</span> <span class="p">(!(</span><span class="nv">$NoSMSTSPresent</span><span class="p">)))</span>
</span><span id="__span-0-250"><a id="__codelineno-0-250" name="__codelineno-0-250" href="#__codelineno-0-250"></a><span class="p">{</span>
</span><span id="__span-0-251"><a id="__codelineno-0-251" name="__codelineno-0-251" href="#__codelineno-0-251"></a>    <span class="nv">$TSenv</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">-COMObject</span> <span class="n">Microsoft</span><span class="p">.</span><span class="n">SMS</span><span class="p">.</span><span class="n">TSEnvironment</span>
</span><span id="__span-0-252"><a id="__codelineno-0-252" name="__codelineno-0-252" href="#__codelineno-0-252"></a>    <span class="k">If</span><span class="p">(</span><span class="nv">$TSEnv</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;OSDTargetSystemDrive&quot;</span><span class="p">)</span> <span class="o">-ne</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="__span-0-253"><a id="__codelineno-0-253" name="__codelineno-0-253" href="#__codelineno-0-253"></a>    <span class="p">{</span>
</span><span id="__span-0-254"><a id="__codelineno-0-254" name="__codelineno-0-254" href="#__codelineno-0-254"></a>        <span class="nv">$Drive</span> <span class="p">=</span> <span class="s2">&quot;</span><span class="p">$(</span><span class="nv">$TSEnv</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;OSDTargetSystemDrive&quot;</span><span class="p">))</span><span class="s2">&quot;</span>
</span><span id="__span-0-255"><a id="__codelineno-0-255" name="__codelineno-0-255" href="#__codelineno-0-255"></a>    <span class="p">}</span>
</span><span id="__span-0-256"><a id="__codelineno-0-256" name="__codelineno-0-256" href="#__codelineno-0-256"></a>    <span class="k">Else</span>
</span><span id="__span-0-257"><a id="__codelineno-0-257" name="__codelineno-0-257" href="#__codelineno-0-257"></a>    <span class="p">{</span>
</span><span id="__span-0-258"><a id="__codelineno-0-258" name="__codelineno-0-258" href="#__codelineno-0-258"></a>        <span class="nv">$Drive</span> <span class="p">=</span> <span class="s2">&quot;</span><span class="p">$(</span><span class="nv">$TSEnv</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;OSDisk&quot;</span><span class="p">))</span><span class="s2">&quot;</span>
</span><span id="__span-0-259"><a id="__codelineno-0-259" name="__codelineno-0-259" href="#__codelineno-0-259"></a>    <span class="p">}</span>
</span><span id="__span-0-260"><a id="__codelineno-0-260" name="__codelineno-0-260" href="#__codelineno-0-260"></a><span class="p">}</span>
</span><span id="__span-0-261"><a id="__codelineno-0-261" name="__codelineno-0-261" href="#__codelineno-0-261"></a><span class="k">ElseIf</span><span class="p">((</span><span class="nv">$Offline</span><span class="p">)</span> <span class="o">-and</span> <span class="p">(</span><span class="nv">$NoSMSTSPresent</span><span class="p">))</span>
</span><span id="__span-0-262"><a id="__codelineno-0-262" name="__codelineno-0-262" href="#__codelineno-0-262"></a><span class="p">{</span>
</span><span id="__span-0-263"><a id="__codelineno-0-263" name="__codelineno-0-263" href="#__codelineno-0-263"></a>    <span class="nv">$Drive</span> <span class="p">=</span> <span class="nv">$NoSMSTS</span>
</span><span id="__span-0-264"><a id="__codelineno-0-264" name="__codelineno-0-264" href="#__codelineno-0-264"></a><span class="p">}</span>
</span><span id="__span-0-265"><a id="__codelineno-0-265" name="__codelineno-0-265" href="#__codelineno-0-265"></a><span class="k">ElseIf</span><span class="p">(</span><span class="nv">$List</span><span class="p">)</span>
</span><span id="__span-0-266"><a id="__codelineno-0-266" name="__codelineno-0-266" href="#__codelineno-0-266"></a><span class="p">{</span>
</span><span id="__span-0-267"><a id="__codelineno-0-267" name="__codelineno-0-267" href="#__codelineno-0-267"></a>    <span class="nv">$Drive</span> <span class="p">=</span> <span class="nv">$env:SystemDrive</span>
</span><span id="__span-0-268"><a id="__codelineno-0-268" name="__codelineno-0-268" href="#__codelineno-0-268"></a><span class="p">}</span>
</span><span id="__span-0-269"><a id="__codelineno-0-269" name="__codelineno-0-269" href="#__codelineno-0-269"></a><span class="nv">$LogDate</span> <span class="p">=</span> <span class="nb">Get-Date</span> <span class="n">-Format</span> <span class="n">yyyyMMddHHmmss</span>
</span><span id="__span-0-270"><a id="__codelineno-0-270" name="__codelineno-0-270" href="#__codelineno-0-270"></a><span class="k">If</span><span class="p">(</span><span class="nv">$DebugInformation</span><span class="p">)</span>
</span><span id="__span-0-271"><a id="__codelineno-0-271" name="__codelineno-0-271" href="#__codelineno-0-271"></a><span class="p">{</span>
</span><span id="__span-0-272"><a id="__codelineno-0-272" name="__codelineno-0-272" href="#__codelineno-0-272"></a>    <span class="nv">$LogPath</span> <span class="p">=</span> <span class="s2">&quot;</span><span class="p">$(</span><span class="nv">$Drive</span><span class="p">)</span><span class="s2">\Windows\Logs&quot;</span>
</span><span id="__span-0-273"><a id="__codelineno-0-273" name="__codelineno-0-273" href="#__codelineno-0-273"></a>    <span class="nv">$LogFile</span> <span class="p">=</span> <span class="s2">&quot;$LogPath\</span><span class="p">$(</span><span class="nv">$myInvocation</span><span class="p">.</span><span class="n">MyCommand</span><span class="p">)</span><span class="s2">_</span><span class="p">$(</span><span class="nv">$LogDate</span><span class="p">)</span><span class="s2">.log&quot;</span>
</span><span id="__span-0-274"><a id="__codelineno-0-274" name="__codelineno-0-274" href="#__codelineno-0-274"></a>
</span><span id="__span-0-275"><a id="__codelineno-0-275" name="__codelineno-0-275" href="#__codelineno-0-275"></a><span class="c">######################</span>
</span><span id="__span-0-276"><a id="__codelineno-0-276" name="__codelineno-0-276" href="#__codelineno-0-276"></a><span class="c">#  START TRANSCRIPT  #</span>
</span><span id="__span-0-277"><a id="__codelineno-0-277" name="__codelineno-0-277" href="#__codelineno-0-277"></a><span class="c">######################</span>
</span><span id="__span-0-278"><a id="__codelineno-0-278" name="__codelineno-0-278" href="#__codelineno-0-278"></a>    <span class="nb">Start-Transcript</span> <span class="nv">$LogFile</span> <span class="n">-Append</span> <span class="n">-NoClobber</span>
</span><span id="__span-0-279"><a id="__codelineno-0-279" name="__codelineno-0-279" href="#__codelineno-0-279"></a>    <span class="nb">Write-Host</span> <span class="s2">&quot;Debug enabled&quot;</span>
</span><span id="__span-0-280"><a id="__codelineno-0-280" name="__codelineno-0-280" href="#__codelineno-0-280"></a><span class="p">}</span>
</span><span id="__span-0-281"><a id="__codelineno-0-281" name="__codelineno-0-281" href="#__codelineno-0-281"></a><span class="c">##########</span>
</span><span id="__span-0-282"><a id="__codelineno-0-282" name="__codelineno-0-282" href="#__codelineno-0-282"></a><span class="c">#  MAIN  #</span>
</span><span id="__span-0-283"><a id="__codelineno-0-283" name="__codelineno-0-283" href="#__codelineno-0-283"></a><span class="c">##########</span>
</span><span id="__span-0-284"><a id="__codelineno-0-284" name="__codelineno-0-284" href="#__codelineno-0-284"></a><span class="nv">$MFJs</span> <span class="p">=</span> <span class="nb">Get-ChildItem</span> <span class="n">-path</span> <span class="nv">$ScriptDir</span> <span class="n">-Recurse</span> <span class="o">-File</span> <span class="n">-Include</span> <span class="s2">&quot;*_manifest.json&quot;</span>
</span><span id="__span-0-285"><a id="__codelineno-0-285" name="__codelineno-0-285" href="#__codelineno-0-285"></a><span class="k">If</span><span class="p">(</span><span class="nv">$Null</span> <span class="o">-eq</span> <span class="nv">$MFJs</span><span class="p">)</span>
</span><span id="__span-0-286"><a id="__codelineno-0-286" name="__codelineno-0-286" href="#__codelineno-0-286"></a><span class="p">{</span>
</span><span id="__span-0-287"><a id="__codelineno-0-287" name="__codelineno-0-287" href="#__codelineno-0-287"></a>    <span class="nb">Write-Host</span> <span class="s2">&quot;No HSA_Manifest.JSON files found in the subfolder structure.&quot;</span>
</span><span id="__span-0-288"><a id="__codelineno-0-288" name="__codelineno-0-288" href="#__codelineno-0-288"></a>    <span class="k">Return</span> <span class="n">3</span>
</span><span id="__span-0-289"><a id="__codelineno-0-289" name="__codelineno-0-289" href="#__codelineno-0-289"></a><span class="p">}</span>
</span><span id="__span-0-290"><a id="__codelineno-0-290" name="__codelineno-0-290" href="#__codelineno-0-290"></a><span class="k">Else</span>
</span><span id="__span-0-291"><a id="__codelineno-0-291" name="__codelineno-0-291" href="#__codelineno-0-291"></a><span class="p">{</span>
</span><span id="__span-0-292"><a id="__codelineno-0-292" name="__codelineno-0-292" href="#__codelineno-0-292"></a>    <span class="nv">$HSAPackages</span> <span class="p">=</span> <span class="p">@()</span>
</span><span id="__span-0-293"><a id="__codelineno-0-293" name="__codelineno-0-293" href="#__codelineno-0-293"></a>    <span class="k">ForEach</span><span class="p">(</span><span class="nv">$MFJ</span> <span class="k">in</span> <span class="nv">$MFJs</span><span class="p">)</span>
</span><span id="__span-0-294"><a id="__codelineno-0-294" name="__codelineno-0-294" href="#__codelineno-0-294"></a>    <span class="p">{</span>
</span><span id="__span-0-295"><a id="__codelineno-0-295" name="__codelineno-0-295" href="#__codelineno-0-295"></a>        <span class="nv">$MFJData</span> <span class="p">=</span> <span class="nb">Get-Content</span> <span class="n">-Path</span> <span class="s2">&quot;</span><span class="p">$(</span><span class="nv">$MFJ</span><span class="p">.</span><span class="n">FullName</span><span class="p">)</span><span class="s2">&quot;</span> <span class="p">|</span> <span class="nb">ConvertFrom-Json</span>
</span><span id="__span-0-296"><a id="__codelineno-0-296" name="__codelineno-0-296" href="#__codelineno-0-296"></a>        <span class="nv">$HSAPackages</span> <span class="p">+=</span> <span class="nb">New-Object</span> <span class="n">PSObject</span> <span class="n">-Property</span> <span class="p">@{</span><span class="s1">&#39;JSONPath&#39;</span> <span class="p">=</span> <span class="nv">$MFJ</span><span class="p">.</span><span class="n">DirectoryName</span><span class="p">;</span> <span class="s1">&#39;HSA&#39;</span> <span class="p">=</span> <span class="nv">$MFJData</span><span class="p">.</span><span class="n">HSA</span><span class="p">;</span> <span class="s1">&#39;Appx&#39;</span> <span class="p">=</span> <span class="nv">$MFJData</span><span class="p">.</span><span class="n">Appx</span><span class="p">;</span> <span class="s1">&#39;License&#39;</span> <span class="p">=</span> <span class="nv">$MFJData</span><span class="p">.</span><span class="n">License</span><span class="p">;</span> <span class="s1">&#39;Dependencies&#39;</span> <span class="p">=</span> <span class="nv">$MFJData</span><span class="p">.</span><span class="n">Dependencies</span><span class="p">}</span>
</span><span id="__span-0-297"><a id="__codelineno-0-297" name="__codelineno-0-297" href="#__codelineno-0-297"></a>    <span class="p">}</span>
</span><span id="__span-0-298"><a id="__codelineno-0-298" name="__codelineno-0-298" href="#__codelineno-0-298"></a><span class="p">}</span>
</span><span id="__span-0-299"><a id="__codelineno-0-299" name="__codelineno-0-299" href="#__codelineno-0-299"></a><span class="k">If</span><span class="p">(</span><span class="nv">$List</span> <span class="o">-or</span> <span class="nv">$PSBoundParameters</span><span class="p">.</span><span class="n">Count</span> <span class="o">-eq</span> <span class="n">0</span> <span class="o">-or</span> <span class="p">(</span><span class="nv">$DebugInformation</span> <span class="o">-and</span> <span class="nv">$PSBoundParameters</span><span class="p">.</span><span class="n">Count</span> <span class="o">-eq</span> <span class="n">1</span><span class="p">))</span>
</span><span id="__span-0-300"><a id="__codelineno-0-300" name="__codelineno-0-300" href="#__codelineno-0-300"></a><span class="p">{</span>
</span><span id="__span-0-301"><a id="__codelineno-0-301" name="__codelineno-0-301" href="#__codelineno-0-301"></a>    <span class="k">If</span><span class="p">(</span><span class="nv">$PSBoundParameters</span><span class="p">.</span><span class="n">ContainsKey</span><span class="p">(</span><span class="s1">&#39;Export&#39;</span><span class="p">))</span>
</span><span id="__span-0-302"><a id="__codelineno-0-302" name="__codelineno-0-302" href="#__codelineno-0-302"></a>    <span class="p">{</span>
</span><span id="__span-0-303"><a id="__codelineno-0-303" name="__codelineno-0-303" href="#__codelineno-0-303"></a>        <span class="k">ForEach</span><span class="p">(</span><span class="nv">$Package</span> <span class="k">in</span> <span class="nv">$HSAPackages</span><span class="p">)</span>
</span><span id="__span-0-304"><a id="__codelineno-0-304" name="__codelineno-0-304" href="#__codelineno-0-304"></a>        <span class="p">{</span>
</span><span id="__span-0-305"><a id="__codelineno-0-305" name="__codelineno-0-305" href="#__codelineno-0-305"></a>            <span class="nv">$Package</span><span class="p">.</span><span class="n">hsa</span> <span class="p">|</span> <span class="nb">Out-File</span> <span class="s2">&quot;$ScriptDir\Export_$LogDate.txt&quot;</span> <span class="n">-Append</span> <span class="n">-Noclobber</span>
</span><span id="__span-0-306"><a id="__codelineno-0-306" name="__codelineno-0-306" href="#__codelineno-0-306"></a>        <span class="p">}</span>
</span><span id="__span-0-307"><a id="__codelineno-0-307" name="__codelineno-0-307" href="#__codelineno-0-307"></a>    <span class="p">}</span>
</span><span id="__span-0-308"><a id="__codelineno-0-308" name="__codelineno-0-308" href="#__codelineno-0-308"></a>    <span class="k">Else</span>
</span><span id="__span-0-309"><a id="__codelineno-0-309" name="__codelineno-0-309" href="#__codelineno-0-309"></a>    <span class="p">{</span>
</span><span id="__span-0-310"><a id="__codelineno-0-310" name="__codelineno-0-310" href="#__codelineno-0-310"></a>        <span class="k">ForEach</span><span class="p">(</span><span class="nv">$Package</span> <span class="k">in</span> <span class="nv">$HSAPackages</span><span class="p">)</span>
</span><span id="__span-0-311"><a id="__codelineno-0-311" name="__codelineno-0-311" href="#__codelineno-0-311"></a>        <span class="p">{</span>
</span><span id="__span-0-312"><a id="__codelineno-0-312" name="__codelineno-0-312" href="#__codelineno-0-312"></a>            <span class="nb">Write-Host</span> <span class="nv">$Package</span><span class="p">.</span><span class="n">hsa</span>
</span><span id="__span-0-313"><a id="__codelineno-0-313" name="__codelineno-0-313" href="#__codelineno-0-313"></a>        <span class="p">}</span>
</span><span id="__span-0-314"><a id="__codelineno-0-314" name="__codelineno-0-314" href="#__codelineno-0-314"></a>    <span class="p">}</span>
</span><span id="__span-0-315"><a id="__codelineno-0-315" name="__codelineno-0-315" href="#__codelineno-0-315"></a><span class="p">}</span>
</span><span id="__span-0-316"><a id="__codelineno-0-316" name="__codelineno-0-316" href="#__codelineno-0-316"></a><span class="k">If</span><span class="p">(</span><span class="nv">$Offline</span><span class="p">)</span>
</span><span id="__span-0-317"><a id="__codelineno-0-317" name="__codelineno-0-317" href="#__codelineno-0-317"></a><span class="p">{</span>
</span><span id="__span-0-318"><a id="__codelineno-0-318" name="__codelineno-0-318" href="#__codelineno-0-318"></a>    <span class="k">If</span><span class="p">(</span><span class="nv">$All</span><span class="p">)</span>
</span><span id="__span-0-319"><a id="__codelineno-0-319" name="__codelineno-0-319" href="#__codelineno-0-319"></a>    <span class="p">{</span>
</span><span id="__span-0-320"><a id="__codelineno-0-320" name="__codelineno-0-320" href="#__codelineno-0-320"></a>        <span class="nb">Write-Host</span> <span class="s2">&quot;Installing all HSAs found in the folder structure.&quot;</span>
</span><span id="__span-0-321"><a id="__codelineno-0-321" name="__codelineno-0-321" href="#__codelineno-0-321"></a>    <span class="p">}</span>
</span><span id="__span-0-322"><a id="__codelineno-0-322" name="__codelineno-0-322" href="#__codelineno-0-322"></a>    <span class="k">ElseIf</span><span class="p">(</span><span class="nv">$NamePresent</span><span class="p">)</span>
</span><span id="__span-0-323"><a id="__codelineno-0-323" name="__codelineno-0-323" href="#__codelineno-0-323"></a>    <span class="p">{</span>
</span><span id="__span-0-324"><a id="__codelineno-0-324" name="__codelineno-0-324" href="#__codelineno-0-324"></a>        <span class="nb">Write-Host</span> <span class="s2">&quot;Installing the $Name HSA.&quot;</span>
</span><span id="__span-0-325"><a id="__codelineno-0-325" name="__codelineno-0-325" href="#__codelineno-0-325"></a>    <span class="p">}</span>
</span><span id="__span-0-326"><a id="__codelineno-0-326" name="__codelineno-0-326" href="#__codelineno-0-326"></a>    <span class="k">ElseIf</span><span class="p">(</span><span class="nv">$FilePresent</span><span class="p">)</span>
</span><span id="__span-0-327"><a id="__codelineno-0-327" name="__codelineno-0-327" href="#__codelineno-0-327"></a>    <span class="p">{</span>
</span><span id="__span-0-328"><a id="__codelineno-0-328" name="__codelineno-0-328" href="#__codelineno-0-328"></a>        <span class="nb">Write-Host</span> <span class="s2">&quot;Reading the list of HSAs from $File.&quot;</span>
</span><span id="__span-0-329"><a id="__codelineno-0-329" name="__codelineno-0-329" href="#__codelineno-0-329"></a>        <span class="k">If</span><span class="p">(!(</span><span class="nb">Test-Path</span> <span class="n">-Path</span> <span class="s2">&quot;$ScriptDir\$File&quot;</span><span class="p">))</span>
</span><span id="__span-0-330"><a id="__codelineno-0-330" name="__codelineno-0-330" href="#__codelineno-0-330"></a>        <span class="p">{</span>
</span><span id="__span-0-331"><a id="__codelineno-0-331" name="__codelineno-0-331" href="#__codelineno-0-331"></a>            <span class="nb">Write-Host</span> <span class="s2">&quot;File: $File not found in $ScriptDir&quot;</span>
</span><span id="__span-0-332"><a id="__codelineno-0-332" name="__codelineno-0-332" href="#__codelineno-0-332"></a>            <span class="k">Return</span> <span class="n">4</span>
</span><span id="__span-0-333"><a id="__codelineno-0-333" name="__codelineno-0-333" href="#__codelineno-0-333"></a>        <span class="p">}</span>
</span><span id="__span-0-334"><a id="__codelineno-0-334" name="__codelineno-0-334" href="#__codelineno-0-334"></a>    <span class="p">}</span>
</span><span id="__span-0-335"><a id="__codelineno-0-335" name="__codelineno-0-335" href="#__codelineno-0-335"></a>    <span class="k">ForEach</span><span class="p">(</span><span class="nv">$Package</span> <span class="k">in</span> <span class="nv">$HSAPackages</span><span class="p">)</span>
</span><span id="__span-0-336"><a id="__codelineno-0-336" name="__codelineno-0-336" href="#__codelineno-0-336"></a>    <span class="p">{</span>
</span><span id="__span-0-337"><a id="__codelineno-0-337" name="__codelineno-0-337" href="#__codelineno-0-337"></a>        <span class="k">If</span><span class="p">(</span><span class="nv">$All</span><span class="p">)</span>
</span><span id="__span-0-338"><a id="__codelineno-0-338" name="__codelineno-0-338" href="#__codelineno-0-338"></a>        <span class="p">{</span>
</span><span id="__span-0-339"><a id="__codelineno-0-339" name="__codelineno-0-339" href="#__codelineno-0-339"></a>            <span class="nb">Install-HSA</span> <span class="n">-HSAPackage</span> <span class="nv">$Package</span>
</span><span id="__span-0-340"><a id="__codelineno-0-340" name="__codelineno-0-340" href="#__codelineno-0-340"></a>        <span class="p">}</span>
</span><span id="__span-0-341"><a id="__codelineno-0-341" name="__codelineno-0-341" href="#__codelineno-0-341"></a>        <span class="k">ElseIf</span><span class="p">(</span><span class="nv">$FilePresent</span> <span class="o">-or</span> <span class="nv">$NamePresent</span><span class="p">)</span>
</span><span id="__span-0-342"><a id="__codelineno-0-342" name="__codelineno-0-342" href="#__codelineno-0-342"></a>        <span class="p">{</span> 
</span><span id="__span-0-343"><a id="__codelineno-0-343" name="__codelineno-0-343" href="#__codelineno-0-343"></a>            <span class="k">If</span><span class="p">(</span><span class="nv">$FilePresent</span><span class="p">)</span>
</span><span id="__span-0-344"><a id="__codelineno-0-344" name="__codelineno-0-344" href="#__codelineno-0-344"></a>            <span class="p">{</span>
</span><span id="__span-0-345"><a id="__codelineno-0-345" name="__codelineno-0-345" href="#__codelineno-0-345"></a>                <span class="nv">$InstallFileArray</span> <span class="p">=</span> <span class="p">@()</span>
</span><span id="__span-0-346"><a id="__codelineno-0-346" name="__codelineno-0-346" href="#__codelineno-0-346"></a>                <span class="nv">$InstallFileArray</span> <span class="p">=</span> <span class="nb">Get-Content</span> <span class="n">-Path</span> <span class="s2">&quot;$ScriptDir\$File&quot;</span>
</span><span id="__span-0-347"><a id="__codelineno-0-347" name="__codelineno-0-347" href="#__codelineno-0-347"></a>                <span class="k">ForEach</span><span class="p">(</span><span class="nv">$InstallFile</span> <span class="k">in</span> <span class="nv">$InstallFileArray</span><span class="p">)</span>
</span><span id="__span-0-348"><a id="__codelineno-0-348" name="__codelineno-0-348" href="#__codelineno-0-348"></a>                <span class="p">{</span>
</span><span id="__span-0-349"><a id="__codelineno-0-349" name="__codelineno-0-349" href="#__codelineno-0-349"></a>                    <span class="nb">Install-HSA</span> <span class="n">-HSAPackage</span> <span class="nv">$Package</span> <span class="n">-HSAName</span> <span class="nv">$InstallFile</span>
</span><span id="__span-0-350"><a id="__codelineno-0-350" name="__codelineno-0-350" href="#__codelineno-0-350"></a>                <span class="p">}</span>
</span><span id="__span-0-351"><a id="__codelineno-0-351" name="__codelineno-0-351" href="#__codelineno-0-351"></a>            <span class="p">}</span>
</span><span id="__span-0-352"><a id="__codelineno-0-352" name="__codelineno-0-352" href="#__codelineno-0-352"></a>            <span class="k">If</span><span class="p">(</span><span class="nv">$NamePresent</span><span class="p">)</span>
</span><span id="__span-0-353"><a id="__codelineno-0-353" name="__codelineno-0-353" href="#__codelineno-0-353"></a>            <span class="p">{</span>
</span><span id="__span-0-354"><a id="__codelineno-0-354" name="__codelineno-0-354" href="#__codelineno-0-354"></a>                <span class="nb">Install-HSA</span> <span class="n">-HSAPackage</span> <span class="nv">$Package</span> <span class="n">-HSAName</span> <span class="nv">$Name</span>
</span><span id="__span-0-355"><a id="__codelineno-0-355" name="__codelineno-0-355" href="#__codelineno-0-355"></a>            <span class="p">}</span>
</span><span id="__span-0-356"><a id="__codelineno-0-356" name="__codelineno-0-356" href="#__codelineno-0-356"></a>        <span class="p">}</span>
</span><span id="__span-0-357"><a id="__codelineno-0-357" name="__codelineno-0-357" href="#__codelineno-0-357"></a>        <span class="nv">$InstallFileArray</span> <span class="p">=</span> <span class="nv">$Null</span>
</span><span id="__span-0-358"><a id="__codelineno-0-358" name="__codelineno-0-358" href="#__codelineno-0-358"></a>    <span class="p">}</span>
</span><span id="__span-0-359"><a id="__codelineno-0-359" name="__codelineno-0-359" href="#__codelineno-0-359"></a><span class="p">}</span>
</span><span id="__span-0-360"><a id="__codelineno-0-360" name="__codelineno-0-360" href="#__codelineno-0-360"></a><span class="k">If</span><span class="p">(</span><span class="nv">$DebugInformation</span><span class="p">)</span>
</span><span id="__span-0-361"><a id="__codelineno-0-361" name="__codelineno-0-361" href="#__codelineno-0-361"></a><span class="p">{</span>
</span><span id="__span-0-362"><a id="__codelineno-0-362" name="__codelineno-0-362" href="#__codelineno-0-362"></a>    <span class="c">#####################</span>
</span><span id="__span-0-363"><a id="__codelineno-0-363" name="__codelineno-0-363" href="#__codelineno-0-363"></a>    <span class="c">#  STOP TRANSCRIPT  #</span>
</span><span id="__span-0-364"><a id="__codelineno-0-364" name="__codelineno-0-364" href="#__codelineno-0-364"></a>    <span class="c">#####################</span>
</span><span id="__span-0-365"><a id="__codelineno-0-365" name="__codelineno-0-365" href="#__codelineno-0-365"></a>    <span class="nb">Stop-Transcript</span>
</span><span id="__span-0-366"><a id="__codelineno-0-366" name="__codelineno-0-366" href="#__codelineno-0-366"></a><span class="p">}</span>
</span></code></pre></div>
<ul>
<li>
<p><strong>List Functionality</strong> – Used to list the names of all Hardware Support Applications in the subdirectories.  Returns the list of all Hardware Support Applications names to the screen.</p>
</li>
<li>
<p><strong>Export</strong> – Used to list the names of all Hardware Support Applications in the subdirectories.  Returns the list of all Hardware Support Applications names to the Export_{Date}{Time}.log file in the same directory from which the script was executed.</p>
</li>
<li>
<p><strong>Offline Install Functionality</strong> – Used to install the Hardware Support Applications.</p>
</li>
<li><strong>All</strong> – Used to install all Hardware Support Applications in the subdirectories below the script.</li>
<li><strong>File</strong> – Used to install a list of Hardware Support Applications.  The text file should be formatted with one Hardware Support Application name per line.  The file should reside in the same folder as the Install-HSA.ps1 script.  The names can be found using the -LIST parameter</li>
<li>
<p><strong>Name</strong> – Used to install one Hardware Support Application.  The name can be found using the -LIST</p>
</li>
<li>
<p><strong>NoSMSTS</strong> – used when running in winPE, but not in a Microsoft.SMS.TSEnvironment, provided by Microsoft Endpoint Manager (MEM) / System Center Configuration Manager (SCCM) or Microsoft Deployment Toolkit (MDT).</p>
</li>
<li>
<p>Call this parameter with the drive letter and colon (:) where the Windows partition has the Windows folder already installed.</p>
</li>
<li>
<p><strong>DebugInformation</strong> – Used to turn on transcript logging and full logging of DISM commands.  The transcript file can be found at C:\Windows\Logs.  There will be a separate log file from each DISM command generated at C:\Windows\Logs\DISM.</p>
</li>
</ul>
<p>For MEM/SCCM and MDT implementations, we are providing the following guidance for the items needed to successfully deploying Lenovo devices. Each implementation has guidance on WinPE Optional Components Requirements, the package to convey the content to the device, and the Task Sequence task information to perform the install.</p>
<h2 id="memsccm-implementation">MEM/SCCM Implementation<a class="headerlink" href="#memsccm-implementation" title="Permanent link">#</a></h2>
<h3 id="windows-pe-optional-components-requirements">Windows PE Optional Components Requirements<a class="headerlink" href="#windows-pe-optional-components-requirements" title="Permanent link">#</a></h3>
<p><img alt="PE Components" src="https://cdrt.github.io/mk_blog/img/2020/hsa_winpe_oc.png" /></p>
<ul>
<li>Microsoft .NET (WinPE-NetFx)</li>
<li>Windows PowerShell (WinPE-PowerShell)</li>
<li>Windows PowerShell (WinPE-DismCmdlets)</li>
</ul>
<h3 id="packaging">Packaging<a class="headerlink" href="#packaging" title="Permanent link">#</a></h3>
<p><img alt="HSA folder" src="https://cdrt.github.io/mk_blog/img/2020/hsa_folder_structure_w_script.png" /></p>
<ol>
<li>Download and extract the required HSA package from Lenovo's website.</li>
<li>Copy the <strong>Install-HSA.ps1</strong> script to the directory where the HSA package was extracted.</li>
<li>Create a legacy package with the source files pointed to the directory where the HSA pack is extracted.  There is no need to create a program associated with this legacy package.</li>
<li>Distribute to your environment.</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are going to install more than one HSA, but not all, and are going to use the -FILE parameter, be sure to include the text file with the list of HSA Names in the same directory as the script file.</p>
</div>
<h3 id="task-sequence">Task Sequence<a class="headerlink" href="#task-sequence" title="Permanent link">#</a></h3>
<p><img alt="Run PowerShell Script" src="https://cdrt.github.io/mk_blog/img/2020/hsa_ts_ps_task_1.png" /></p>
<p><img alt="Options" src="https://cdrt.github.io/mk_blog/img/2020/hsa_ts_ps_task_2.png" /></p>
<ol>
<li>After the Apply Operating System task, but before the Setup Windows and Configuration Manager task, add a <strong>Run PowerShell Script</strong> task.</li>
<li>On the Properties tab, choose the <strong>Select a package with a PowerShell script</strong> option.  Click the Browse button to locate and select the package created above.</li>
<li>In the Script name textbox, enter <strong>Install-HSA.ps1</strong>.</li>
<li>In the Parameters textbox, enter the parameters required.  Ex. -Offline -All -DebugInformation.</li>
<li>On the Options tab, if needed, add the <strong>conditional statement</strong> and any <strong>WMI queries</strong> to target by model.</li>
</ol>
<h2 id="mdt-implementation">MDT Implementation<a class="headerlink" href="#mdt-implementation" title="Permanent link">#</a></h2>
<h3 id="winpe-features-requirements">WinPE Features Requirements<a class="headerlink" href="#winpe-features-requirements" title="Permanent link">#</a></h3>
<p><img alt="PE components" src="https://cdrt.github.io/mk_blog/img/2020/hsa_winpe.png" /></p>
<ul>
<li>.NET Framework</li>
<li>Windows PowerShell</li>
<li>DISM Cmdlets</li>
</ul>
<h3 id="application">Application<a class="headerlink" href="#application" title="Permanent link">#</a></h3>
<p><img alt="HSA folder" src="https://cdrt.github.io/mk_blog/img/2020/hsa_folder.png" /></p>
<ol>
<li>Download and extract the required HSA package from Lenovo's website.</li>
<li>Copy the <strong>Install-HSA.ps1</strong> script to the directory where the HSA package was extracted.</li>
<li>Create an application in MDT.  We will use this to neatly store the files in MDT.  When the wizard asks for executable, you can put anything, as we will not be using the application functionality to install the HSA.</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are going to install more than one HSA, but not all, and are going to use the -FILE parameter, be sure to include the text file with the list of HSA Names in the same directory as the script file.</p>
</div>
<h3 id="mdt-task-sequence">MDT Task Sequence<a class="headerlink" href="#mdt-task-sequence" title="Permanent link">#</a></h3>
<p><img alt="Run command line" src="https://cdrt.github.io/mk_blog/img/2020/hsa_mdt_ts1.png" /></p>
<p><img alt="Options" src="https://cdrt.github.io/mk_blog/img/2020/hsa_mdt_ts2.png" /></p>
<ol>
<li>In the Task Sequence, after the Apply Operating System task in the Install phase, but before the Restart Computer task in the PostInstall phase, add a Run Command Line task and give it a name.</li>
<li>In the command line, enter the following command:
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>powershell.exe -WindowStyle Hidden -ExecutionPolicy Bypass -Command &quot;Copy-Item &#39;%DeployRoot%\Applications\{ApplicationFolderNameHere}&#39; -Destination %OSDisk%\OSDTemp\ -Recurse; %OSDisk%\OSDTemp\Install-HSA.ps1 -OFFLINE -ALL -DEBUGINFORMATION; Remove-Item %OSDisk%\OSDTemp -Recurse -Force&quot;
</span></code></pre></div>
The command above will copy all files and folders from the Application folder defined, execute the Install-HSA.ps1 script, and remove the content from the %OSDisk% drive.</li>
<li>Be sure to change {ApplicationFolderNameHere} to the actual folder name of the Application.</li>
<li>On the <strong>Options</strong> tab, if needed, add the <strong>conditional statement</strong> and any <strong>WMI queries</strong> to target by model.</li>
</ol>
<h2 id="noteworthy">Noteworthy<a class="headerlink" href="#noteworthy" title="Permanent link">#</a></h2>
<ul>
<li><strong>Not Applicable HSAs</strong> - Even though an HSA is in a Lenovo supplied HSA pack, that does not necessarily mean it will apply to every build of a model.  For example:</li>
<li>On the ThinkPad T15 Gen 1, not all builds of this model will have an Nvidia Graphics Card, so the Nvidia Graphics HSA may or may not be needed.</li>
<li>Many models have an option to utilize Intel Optane Storage.  The HSA is only needed if the device contains the Optane disk drive.</li>
<li><strong>HSAs not installing as SYSTEM account</strong> - In an MEM/SCCM Task Sequence, after the Setup Windows and Configuration Manager task, the task sequence runs as the SYSTEM account.  Many HSAs will not install under the SYSTEM account, so we recommend installing in WinPE.</li>
</ul>







  
  



  


  



      
    </article>
  </div>

          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; 2025 <a href="https://blog.lenovocdrt.com"  target="_blank" rel="noopener">Lenovo Commercial Deployment Readiness Team</a><br><a href="#__consent" style="text-decoration:underline;">Change cookie settings</a>

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            



<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
    
      
        
  
  
    
    
  
  <li class="task-list-item">
    <label class="task-list-control">
      <input type="checkbox" name="analytics" checked>
      <span class="task-list-indicator"></span>
      Google Analytics
    </label>
  </li>

      
    
    
      
    
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
      <button type="reset" class="md-button md-button--primary">Reject</button>
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script>
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tracking", "navigation.instant", "navigation.instant.progress", "navigation.expand", "navigation.path", "navigation.sections", "toc.integrate", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy", "content.code.select"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="../js/open_in_new_tab.js"></script>
      
    
  </body>
</html>