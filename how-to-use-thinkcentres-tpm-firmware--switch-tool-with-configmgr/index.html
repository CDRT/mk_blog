
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Ideas for managing Lenovo devices in the corporate environment.">
      
      
      
        <link rel="canonical" href="https://blog.lenovocdrt.com/how-to-use-thinkcentres-tpm-firmware--switch-tool-with-configmgr/">
      
      
        <link rel="prev" href="../dynamically-updating-think-product-bios-with-configmgr/">
      
      
        <link rel="next" href="../upgrading-tpm-spec-12-to-20-on-thinkpad-using-configmgr-current-branch/">
      
      
        
      
      
      <link rel="icon" href="../img/fav/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>How to Use ThinkCentre's TPM Firmware <br> Switch Tool with ConfigMgr - ThinkDeploy Blog</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-288025816"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-288025816",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-288025816",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script>
  

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="light-blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#group-1-set-ts-variables" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="ThinkDeploy Blog" class="md-header__button md-logo" aria-label="ThinkDeploy Blog" data-md-component="logo">
      
  <img src="../img/CDRT-REV-Red_s.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ThinkDeploy Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              How to Use ThinkCentre's TPM Firmware <br> Switch Tool with ConfigMgr
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="light-blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="blue-grey"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="ThinkDeploy Blog" class="md-nav__button md-logo" aria-label="ThinkDeploy Blog" data-md-component="logo">
      
  <img src="../img/CDRT-REV-Red_s.png" alt="logo">

    </a>
    ThinkDeploy Blog
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../about/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    About
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../feed.xml" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    RSS
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Archive
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Archive
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../archive/2025/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2025
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../archive/2024/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2024
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../archive/2023/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2023
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../archive/2022/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2022
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../archive/2021/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2021
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../archive/2020/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2020
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../archive/2019/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2019
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../archive/2018/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2018
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../archive/2017/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2017
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
  <div class="md-content md-content--post" data-md-component="content">
    <div class="md-sidebar md-sidebar--post" data-md-component="sidebar" data-md-type="navigation">
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner md-post">
          <nav class="md-nav md-nav--primary">
            <div class="md-post__back">
              <div class="md-nav__title md-nav__container">
                <a href=".." class="md-nav__link">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
                  <span class="md-ellipsis">
                    Back to index
                  </span>
                </a>
              </div>
            </div>
            
              <div class="md-post__authors md-typeset">
                
                  <div class="md-profile md-post__profile">
                    <span class="md-author md-author--long">
                      <img src="../img/fav/avatar.png" alt="Philip Jorgensen">
                    </span>
                    <span class="md-profile__description">
                      <strong>
                        
                          Philip Jorgensen
                        
                      </strong>
                      <br>
                      Deployment Expert
                    </span>
                  </div>
                
              </div>
            
            <ul class="md-post__meta md-nav__list">
              <li class="md-nav__item md-nav__item--section">
                <div class="md-post__title">
                  <span class="md-ellipsis">
                    Metadata
                  </span>
                </div>
                <nav class="md-nav">
                  <ul class="md-nav__list">
                    <li class="md-nav__item">
                      <div class="md-nav__link">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5z"/></svg>
                        <time datetime="2018-03-26 00:00:00+00:00" class="md-ellipsis">March 26, 2018</time>
                      </div>
                    </li>
                    
                    
                    
                      
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7z"/></svg>
                          <span class="md-ellipsis">
                            
                              5 min read
                            
                          </span>
                        </div>
                      </li>
                    
                  </ul>
                </nav>
              </li>
            </ul>
            
          </nav>
          
            

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#group-1-set-ts-variables" class="md-nav__link">
    <span class="md-ellipsis">
      
        Group 1-Set TS Variables
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#group-2-disable-bitlocker" class="md-nav__link">
    <span class="md-ellipsis">
      
        Group 2-Disable BitLocker
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#group-3-configure-tpm" class="md-nav__link">
    <span class="md-ellipsis">
      
        Group 3-Configure TPM
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#group4-thinkcentre" class="md-nav__link">
    <span class="md-ellipsis">
      
        Group4-ThinkCentre
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#group5-tpm-spec-12-to-20" class="md-nav__link">
    <span class="md-ellipsis">
      
        Group5-TPM Spec 1.2 to 2.0
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#further-research-notes-and-caveats" class="md-nav__link">
    <span class="md-ellipsis">
      
        Further research, notes and caveats
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
          
        </div>
      </div>
    </div>
    <article class="md-content__inner md-typeset">
      
        
  




  <h1>How to Use ThinkCentre's TPM Firmware <br> Switch Tool with ConfigMgr</h1>

<p>This article will cover the TPM Firmware Switch Tool that was released to remedy affected ThinkCentres described in the <a href="https://support.lenovo.com/us/en/product_security/len-15552">LEN-15552 Security Advisory</a>.</p>
<!-- more -->
<table>
<thead>
<tr>
<th>M71x-Series</th>
<th>M91x-Series</th>
</tr>
</thead>
<tbody>
<tr>
<td>M710t</td>
<td>M910t</td>
</tr>
<tr>
<td>M710s</td>
<td>M910s</td>
</tr>
<tr>
<td>M710q</td>
<td>M910q</td>
</tr>
<tr>
<td>M715s</td>
<td>M910x</td>
</tr>
<tr>
<td>M715t</td>
<td></td>
</tr>
</tbody>
</table>
<div class="admonition info">
<p>If a system is configured for TPM 2.0, the BIOS level must be at a specific level before the firmware update can be applied. Links to the BIOS versions can be found in the matrix.</p>
</div>
<p>To summarize, the tool will update the TPM firmware to the latest version, whether it be TPM Spec 1.2 or 2.0. It will also allow you to switch the TPM Spec version from 1.2 to 2.0 or vice versa if desired, while also applying the latest TPM firmware in the process.</p>
<p>BitLocker (or an alternative) will need to be suspended prior to performing the update otherwise you will be prompted for the Recovery Key after the flash completes and the system reboots. Most importantly, a <strong>Supervisor Password</strong> is required before attempting to update or switch the TPM firmware.</p>
<p>After you've downloaded and extracted the contents of the tool to a source location, you'll want to edit the flash.cmd by removing the shutdown switch that forces the system to reboot. That way, you can call the shutdown at the end of the task sequence with the <strong>SMSTSPostAction</strong> variable.</p>
<p>Look for the following line in the flash.cmd and remove <strong>/shutdown</strong> and save the file.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>%Flashtool% /CAPFILE:%FWFILE% /pw:%BIOSPWD% /shutdown
</span></code></pre></div>
<p>Create a Package in your ConfigMgr console, no program, pointing to the source location of where you extracted the contents of the zip.</p>
<p>Below is a sample Task Sequence that shows the workflow of how this tool can be used to switch TPM Spec versions while applying the latest firmware:</p>
<p><img alt="" src="https://cdrt.github.io/mk_blog/img/2018/tc_tpm_fwswitch_tool/image1.jpg" /></p>
<h2 id="group-1-set-ts-variables">Group 1-Set TS Variables<a class="headerlink" href="#group-1-set-ts-variables" title="Permanent link">#</a></h2>
<ul>
<li>Check SecurityChipStatus - Task Sequence Variable</li>
</ul>
<p><img alt="" src="https://cdrt.github.io/mk_blog/img/2018/tc_tpm_fwswitch_tool/image2.jpg" /></p>
<p><img alt="" src="https://cdrt.github.io/mk_blog/img/2018/tc_tpm_fwswitch_tool/image3.jpg" /></p>
<p>WMI Query to check if the Security Chip is Spec 1.2</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>SELECT * From Lenovo_BiosSetting WHERE CurrentSetting LIKE &#39;Security Chip 1.2,Active&#39;
</span></code></pre></div>
<div class="admonition info">
<p>The value here may differ across models, i.e. <strong>SecurityChip, Active</strong> or <strong>Security Chip,Enable</strong>. Be sure to double check this before adding your query.</p>
</div>
<ul>
<li>Set <strong>OSDBitLockerStatus</strong> task sequence variable (credit to <a href="https://miketerrill.net/2017/04/19/how-to-detect-suspend-and-re-enable-bitlocker-during-a-task-sequence/">Mike Terrill</a>).</li>
</ul>
<p><img alt="" src="https://cdrt.github.io/mk_blog/img/2018/tc_tpm_fwswitch_tool/image4.jpg" /></p>
<p><img alt="" src="https://cdrt.github.io/mk_blog/img/2018/tc_tpm_fwswitch_tool/image5.jpg" /></p>
<p>WMI Query to check if the system drive is encrypted and protection is on.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>SELECT * From Win32_EncryptableVolume WHERE DriveLetter = &#39;C:&#39; and ProtectionsStatus = &#39;1&#39;
</span></code></pre></div>
<ul>
<li>ThinkCentre SMSTSPostAction - Task Sequence Variable</li>
</ul>
<div class="admonition info">
<p>This will invoke the flash due to the required shutdown. Remember this was removed from <strong>flash.cmd</strong> earlier, otherwise the task sequence would break.</p>
</div>
<p><img alt="" src="https://cdrt.github.io/mk_blog/img/2018/tc_tpm_fwswitch_tool/image6.jpg" /></p>
<p><img alt="" src="https://cdrt.github.io/mk_blog/img/2018/tc_tpm_fwswitch_tool/image7.jpg" /></p>
<p>WMI Query to check if the system is a ThinkCentre</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>SELECT * FROM Win32_ComputerSystemProduct WHERE Version LIKE &#39;ThinkCentre%&#39;
</span></code></pre></div>
<h2 id="group-2-disable-bitlocker">Group 2-Disable BitLocker<a class="headerlink" href="#group-2-disable-bitlocker" title="Permanent link">#</a></h2>
<ul>
<li>Native Disable BitLocker step</li>
</ul>
<p><img alt="" src="https://cdrt.github.io/mk_blog/img/2018/tc_tpm_fwswitch_tool/image8.jpg" /></p>
<p><img alt="" src="https://cdrt.github.io/mk_blog/img/2018/tc_tpm_fwswitch_tool/image9.jpg" /></p>
<p>Add a condition to check if Task Sequence Variable <strong>OSDBitLockerStatus</strong> status equals <strong>Protected</strong>.</p>
<h2 id="group-3-configure-tpm">Group 3-Configure TPM<a class="headerlink" href="#group-3-configure-tpm" title="Permanent link">#</a></h2>
<p><img alt="" src="https://cdrt.github.io/mk_blog/img/2018/tc_tpm_fwswitch_tool/image10.jpg" /></p>
<p>Add a condition to check if Task Sequence Variable <strong>SecurityChipStatus</strong> does not equal <strong>Ready</strong>.</p>
<ul>
<li>Download Think BIOS Config Tool - Download Package Content Step<ul>
<li>I'm using the <a href="https://docs.lenovocdrt.com/guides/tbct/tbct_top">Think BIOS Config Tool</a> to enable the security chip.</li>
</ul>
</li>
</ul>
<p><img alt="" src="https://cdrt.github.io/mk_blog/img/2018/tc_tpm_fwswitch_tool/image11.jpg" /></p>
<ul>
<li>Run Command Line - Enable TPM</li>
</ul>
<p><img alt="" src="https://cdrt.github.io/mk_blog/img/2018/tc_tpm_fwswitch_tool/image12.jpg" /></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>cmd.exe /c %BIOSConfig01%\ThinkBiosConfig.hta &quot;file=BIOSConfig.ini&quot; &quot;pass=1234567&quot;
</span></code></pre></div>
<p>By using the BIOS Config Tool, I'm calling the configuration file .ini that holds the value to enable the security chip while passing the Supervisor Password. Alternatively, this can be achieved using Run Command Line steps calling PowerShell and setting/saving the BIOS settings stored in the Lenovo_BiosSetting namespace.</p>
<ul>
<li>Restart Computer Step - Back to Operating System</li>
</ul>
<p><img alt="" src="https://cdrt.github.io/mk_blog/img/2018/tc_tpm_fwswitch_tool/image13.jpg" /></p>
<h2 id="group4-thinkcentre">Group4-ThinkCentre<a class="headerlink" href="#group4-thinkcentre" title="Permanent link">#</a></h2>
<p><img alt="" src="https://cdrt.github.io/mk_blog/img/2018/tc_tpm_fwswitch_tool/image14.jpg" /></p>
<p>These WMI queries will check the first 4 characters of the BIOS version, which matches to each of the affected ThinkCentres as noted in the security bulletin matrix. Refer to the <a href="https://download.lenovo.com/cdrt/ddrc/RecipeCardWeb.html">Deployment Recipe Card</a> for these queries.</p>
<h2 id="group5-tpm-spec-12-to-20">Group5-TPM Spec 1.2 to 2.0<a class="headerlink" href="#group5-tpm-spec-12-to-20" title="Permanent link">#</a></h2>
<p><img alt="" src="https://cdrt.github.io/mk_blog/img/2018/tc_tpm_fwswitch_tool/image15.jpg" /></p>
<p>WMI Query to check the TPM Spec is 1.2 before continuing to switch to 2.0.</p>
<p><strong>Namespace: root\cimv2\Security\MicrosoftTpm</strong></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>SELECT * From Win32_Tpm WHERE SpecVersion LIKE &#39;1.2%&#39;
</span></code></pre></div>
<ul>
<li>Run Command Line-Update TPM Firmware</li>
</ul>
<p><img alt="" src="https://cdrt.github.io/mk_blog/img/2018/tc_tpm_fwswitch_tool/image16.jpg" /></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>flash.cmd /2 1234567 /s
</span></code></pre></div>
<h2 id="further-research-notes-and-caveats">Further research, notes and caveats<a class="headerlink" href="#further-research-notes-and-caveats" title="Permanent link">#</a></h2>
<ul>
<li>If the Security Chip is Inactive, the TPM will not have an owner. Once the <strong>Configure TPM</strong> group is executed and Security Chip becomes Active, Windows 10 will take ownership of the TPM automatically.  Clearing the TPM will not be necessary after this.</li>
<li>If down-leveling from TPM 2.0 to 1.2 using the /1 switch, adjust the SpecVersion query to:</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>SELECT * FROM Win32_TPM WHERE SpecVersion LIKE &#39;2.0%&#39;
</span></code></pre></div>
<ul>
<li>As a result of down-leveling, the TPM will become disabled, inactive, and unowned. This can be fixed using the <strong>SetPhysicalPresenceRequest</strong> <a href="https://docs.microsoft.com/en-us/windows/win32/secprov/setphysicalpresencerequest-win32-tpm">method</a>.  (10-Enable, activate, and allow the installation of a TPM owner.)</li>
<li>Windows 10 will automatically re-enable BitLocker after the reboot.</li>
</ul>







  
  



  


  



      
    </article>
  </div>

          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; 2025 <a href="https://blog.lenovocdrt.com"  target="_blank" rel="noopener">Lenovo Commercial Deployment Readiness Team</a><br><a href="#__consent" style="text-decoration:underline;">Change cookie settings</a>

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            



  

<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences such as light and dark mode, as well as to measure anonymous usage data to determine effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input class="md-toggle" type="checkbox" id="__settings" checked>
<div class="md-consent__settings">
  <ul class="task-list">
    
    
      
        
  
  
    
    
  
  <li class="task-list-item">
    <label class="task-list-control">
      <input type="checkbox" name="analytics" checked>
      <span class="task-list-indicator"></span>
      Google Analytics
    </label>
  </li>

      
    
    
      
    
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
      <button type="reset" class="md-button md-button--primary">Reject</button>
    
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script>
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.tracking", "navigation.instant", "navigation.instant.progress", "navigation.expand", "navigation.path", "navigation.sections", "toc.integrate", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy", "content.code.select"], "search": "../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
        <script src="../js/open_in_new_tab.js"></script>
      
    
  </body>
</html>